<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš‚ THE UPSIDE DOWN EXPRESS | à¸¥à¸³à¸žà¸¹à¸™ â†’ PSRU</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            background: #000;
            overflow: hidden;
            font-family: 'Fira Code', monospace;
            color: #ff0000;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(30, 0, 0, 0.9), transparent);
            z-index: 10;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
        }

        #hud h1 {
            margin: 0;
            font-size: 1.2rem;
            letter-spacing: 4px;
            text-shadow: 0 0 10px #ff0000;
        }

        #hud span {
            color: #fff;
        }

        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.4) 50%);
            background-size: 100% 3px;
            pointer-events: none;
            z-index: 20;
            opacity: 0.3;
        }

        .vignette {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            box-shadow: inset 0 0 200px #000;
            pointer-events: none;
            z-index: 15;
        }

        #station-info {
            text-align: right;
        }

        #station-name {
            font-size: 1rem;
            font-weight: bold;
        }

        #station-detail {
            font-size: 0.7rem;
            color: #880000;
        }

        #controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 30;
        }

        .btn {
            background: #1a0000;
            border: 1px solid #ff0000;
            color: #ff0000;
            padding: 5px 15px;
            font-size: 0.7rem;
            cursor: pointer;
        }

        .btn:hover {
            background: #ff0000;
            color: #000;
        }
    </style>
</head>

<body>
    <div class="scanlines"></div>
    <div class="vignette"></div>
    <div id="canvas-container">
        <div id="hud">
            <div>
                <h1><span>THE</span> UPSIDE_DOWN_EXPRESS</h1>
                <p style="font-size: 0.6rem; margin: 0; color: #660000;">// CLASSIFIED TRANSPORTATION ROUTE // LAMPHUN
                    -> PSRU</p>
            </div>
            <div id="station-info">
                <div id="station-name">INITIALIZING...</div>
                <div id="station-detail">SEARCHING_SIGNAL</div>
            </div>
        </div>
        <div id="controls">
            <button class="btn" onclick="cycleCamera()">ðŸ“· TOGGLE_VIEW</button>
            <button class="btn" onclick="resetTrain()">ðŸ”„ SYNC_TIME</button>
            <button class="btn" onclick="window.location.href='index.html'" style="color:#e50914;">â—‚ RETURN_CV</button>
            <button class="btn" onclick="window.location.href='dustboy-cyber.html'" style="color:#ff007f;">CYBER_DB
                â–¸</button>
        </div>
    </div>

    <script>
        const stationData = [
            { lat: 18.464717, lon: 99.05675, place: "LAMPHUN", locality: "Dimension Alpha Entry" },
            { lat: 18.281088, lon: 99.469882, place: "LAMPANG", locality: "Rift Sub-Station" },
            { lat: 17.97274, lon: 100.052057, place: "DEN_CHAI", locality: "Abyssal Pass" },
            { lat: 17.594402, lon: 100.093817, place: "UTTARADIT", locality: "Shadow Realm Border" },
            { lat: 16.817687, lon: 100.258201, place: "PSRU", locality: "Data Core Center" }
        ];

        const minLat = 16.81, maxLat = 18.47, minLon = 99.05, maxLon = 100.26;
        const SCALE = 800;
        function gpsToWorld(lat, lon) {
            const x = ((lon - minLon) / (maxLon - minLon) - 0.5) * SCALE;
            const z = ((maxLat - lat) / (maxLat - minLat) - 0.5) * SCALE;
            return new THREE.Vector3(x, 0, z);
        }

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050000);
        scene.fog = new THREE.FogExp2(0x1a0000, 0.005);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 5000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0x440000, 1));
        const riftLight = new THREE.PointLight(0xff0000, 2, 1000);
        riftLight.position.set(0, 100, 0);
        scene.add(riftLight);

        // Ground (Organic/Blood Grid)
        const groundGeo = new THREE.PlaneGeometry(2000, 2000, 50, 50);
        const groundMat = new THREE.MeshPhongMaterial({ color: 0x0a0000, wireframe: true });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // Track (Blood Vessel)
        const trackPoints = stationData.map(s => gpsToWorld(s.lat, s.lon));
        const curve = new THREE.CatmullRomCurve3(trackPoints);
        const trackGeo = new THREE.BufferGeometry().setFromPoints(curve.getPoints(200));
        const trackMat = new THREE.LineBasicMaterial({ color: 0xff0000, transparent: true, opacity: 0.5 });
        scene.add(new THREE.Line(trackGeo, trackMat));

        // Dead Trees
        for (let i = 0; i < 150; i++) {
            const t = Math.random();
            const pos = curve.getPoint(t);
            const offset = (Math.random() - 0.5) * 100;
            const treeGroup = new THREE.Group();

            const trunk = new THREE.Mesh(
                new THREE.BoxGeometry(1, 20 + Math.random() * 20, 1),
                new THREE.MeshBasicMaterial({ color: 0x000000 })
            );
            treeGroup.add(trunk);

            // Random branches (spindly)
            for (let j = 0; j < 3; j++) {
                const b = new THREE.Mesh(new THREE.BoxGeometry(0.5, 10, 0.5), new THREE.MeshBasicMaterial({ color: 0x000000 }));
                b.position.y = 5;
                b.rotation.z = Math.random();
                treeGroup.add(b);
            }

            treeGroup.position.set(pos.x + offset, 0, pos.z + (Math.random() - 0.5) * 100);
            scene.add(treeGroup);
        }

        // Ash Particles
        const ashCount = 1000;
        const ashGeo = new THREE.BufferGeometry();
        const ashPos = new Float32Array(ashCount * 3);
        for (let i = 0; i < ashCount * 3; i++) ashPos[i] = (Math.random() - 0.5) * 1000;
        ashGeo.setAttribute('position', new THREE.BufferAttribute(ashPos, 3));
        const ashMat = new THREE.PointsMaterial({ color: 0x660000, size: 2, transparent: true, opacity: 0.6 });
        const ash = new THREE.Points(ashGeo, ashMat);
        scene.add(ash);

        // Train (Shadow Hulk)
        const train = new THREE.Group();
        const body = new THREE.Mesh(new THREE.BoxGeometry(6, 4, 12), new THREE.MeshBasicMaterial({ color: 0x000000 }));
        train.add(body);
        const redLight = new THREE.PointLight(0xff0000, 5, 50);
        redLight.position.set(0, 5, 0);
        train.add(redLight);
        scene.add(train);

        let progress = 0;
        let camMode = 0;

        function cycleCamera() { camMode = (camMode + 1) % 2; }
        function resetTrain() { progress = 0; }

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;

            progress += 0.0005;
            if (progress > 1) progress = 0;

            const pos = curve.getPoint(progress);
            const tangent = curve.getTangent(progress);
            train.position.copy(pos);
            train.lookAt(pos.clone().add(tangent));

            // Ash motion
            const p = ash.geometry.attributes.position.array;
            for (let i = 0; i < ashCount; i++) {
                p[i * 3 + 1] -= 0.2;
                if (p[i * 3 + 1] < -100) p[i * 3 + 1] = 500;
            }
            ash.geometry.attributes.position.needsUpdate = true;

            // Camera
            if (camMode === 0) {
                const camPos = pos.clone().add(tangent.clone().multiplyScalar(-50)).add(new THREE.Vector3(0, 30, 0));
                camera.position.lerp(camPos, 0.1);
                camera.lookAt(pos);
            } else {
                camera.position.set(0, 400, 100);
                camera.lookAt(0, 0, 0);
            }

            // HUD
            const idx = Math.floor(progress * stationData.length);
            const s = stationData[Math.min(idx, stationData.length - 1)];
            document.getElementById('station-name').textContent = s.place;
            document.getElementById('station-detail').textContent = s.locality;

            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>

</html>